<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Closest Match: Gorilla Color Tool</title>
  <style>
    @font-face {
      font-family: 'GTAG';
      src: url('GTAG Font Remake B3.ttf');
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #121212;
      color: white;
      text-align: center;
      padding: 20px;
    }

    .container {
      max-width: 750px;
      margin: auto;
      background: #1e1e1e;
      padding: 30px;
      border-radius: 20px;
      border: 1px solid #333;
    }

    .result-display {
      font-family: 'GTAG', sans-serif;
      font-size: 60px;
      margin: 20px 0;
      text-shadow: 3px 3px 0px #000;
    }
    .val-r { color: #ff3e3e; }
    .val-g { color: #3eff3e; }
    .val-b { color: #3e3eff; }

    .display-flex {
      display: flex;
      justify-content: space-around;
      margin-bottom: 25px;
    }

    canvas {
      border: 3px solid #000;
      border-radius: 10px;
      width: 180px;
      height: 180px;
      cursor: crosshair;
    }

    /* Slider Styling - Fixing the "blending in" issue */
    .slider { 
      -webkit-appearance: none;
      width: 80%; 
      height: 8px;
      background: #333;
      outline: none;
      border-radius: 5px;
      margin: 20px 0;
    }

    /* The Slider Button (Thumb) - Adding high contrast border */
    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: #eee;
      border: 3px solid #000;
      cursor: pointer;
      box-shadow: 0 0 5px rgba(0,0,0,0.5);
    }

    /* Save Slots */
    .save-slots {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-top: 20px;
    }
    .slot {
      width: 110px;
      background: #121212;
      padding: 10px;
      border-radius: 10px;
      border: 2px solid #444;
      cursor: pointer;
      transition: all 0.2s;
    }
    .slot.selected {
      border-color: #fff;
      background: #2a2a2a;
      transform: scale(1.05);
    }
    .slot-preview {
      width: 100%;
      height: 45px;
      border-radius: 5px;
      margin-bottom: 8px;
      background: #222;
      border: 1px solid #000;
    }

    .btn {
      padding: 10px 20px;
      background: #444;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    .btn:hover { background: #555; }

    .disclaimer {
      margin-top: 20px;
      font-size: 14px;
      color: #888;
    }
  </style>
</head>
<body>

<div class="container">
  <h1>CLOSEST MATCH</h1>

  <div class="display-flex">
    <canvas id="desiredCanvas" width="200" height="200"></canvas>
    <canvas id="closestCanvas" width="200" height="200"></canvas>
  </div>

  <div class="result-display">
    <span class="val-r" id="rNum">0</span> 
    <span class="val-g" id="gNum">0</span> 
    <span class="val-b" id="bNum">0</span>
  </div>

  <input type="range" id="rS" class="slider" min="0" max="9" value="0" oninput="sync()">
  <input type="range" id="gS" class="slider" min="0" max="9" value="0" oninput="sync()">
  <input type="range" id="bS" class="slider" min="0" max="9" value="0" oninput="sync()">

  <div class="disclaimer">
    *Note: 0 0 0 appears as a shiny black in-game due to material shaders.
  </div>

  <div style="margin-top: 40px;">
    <h3>SAVED COLORS</h3>
    <p style="font-size:12px; color:#666;">Select a slot, then click Save to overwrite it.</p>
    <div class="save-slots">
      <div class="slot selected" onclick="selectSlot(0)" id="slot0"><div class="slot-preview"></div>Empty</div>
      <div class="slot" onclick="selectSlot(1)" id="slot1"><div class="slot-preview"></div>Empty</div>
      <div class="slot" onclick="selectSlot(2)" id="slot2"><div class="slot-preview"></div>Empty</div>
      <div class="slot" onclick="selectSlot(3)" id="slot3"><div class="slot-preview"></div>Empty</div>
      <div class="slot" onclick="selectSlot(4)" id="slot4"><div class="slot-preview"></div>Empty</div>
    </div>
    <br>
    <button class="btn" onclick="saveToSelected()">Save to Selected Slot</button>
  </div>
</div>

<script>
  const dCtx = document.getElementById('desiredCanvas').getContext('2d');
  const cCtx = document.getElementById('closestCanvas').getContext('2d');
  const furImg = new Image();
  furImg.src = 'gorilla-fur-texture.png';

  let selectedSlotIndex = 0;
  let savedColors = [null, null, null, null, null];

  furImg.onload = () => sync();

  function sync() {
    let r9 = document.getElementById('rS').value;
    let g9 = document.getElementById('gS').value;
    let b9 = document.getElementById('bS').value;

    document.getElementById('rNum').innerText = r9;
    document.getElementById('gNum').innerText = g9;
    document.getElementById('bNum').innerText = b9;

    let r = Math.round((r9 / 9) * 255);
    let g = Math.round((g9 / 9) * 255);
    let b = Math.round((b9 / 9) * 255);

    draw(dCtx, r, g, b);
    draw(cCtx, r, g, b);
  }

  function draw(ctx, r, g, b) {
    ctx.clearRect(0, 0, 200, 200);
    ctx.drawImage(furImg, 0, 0, 200, 200);
    ctx.globalCompositeOperation = 'multiply';
    ctx.fillStyle = `rgb(${r}, ${g}, ${b})`;
    ctx.fillRect(0, 0, 200, 200);
    ctx.globalCompositeOperation = 'destination-atop';
    ctx.drawImage(furImg, 0, 0, 200, 200);
    ctx.globalCompositeOperation = 'source-over';
  }

  function selectSlot(i) {
    document.querySelectorAll('.slot').forEach(s => s.classList.remove('selected'));
    document.getElementById(`slot${i}`).classList.add('selected');
    selectedSlotIndex = i;
    
    // If slot is filled, load the color when clicking
    if(savedColors[i]) {
      document.getElementById('rS').value = savedColors[i].r;
      document.getElementById('gS').value = savedColors[i].g;
      document.getElementById('bS').value = savedColors[i].b;
      sync();
    }
  }

  function saveToSelected() {
    let r9 = document.getElementById('rS').value;
    let g9 = document.getElementById('gS').value;
    let b9 = document.getElementById('bS').value;
    
    savedColors[selectedSlotIndex] = { r: r9, g: g9, b: b9 };
    
    let r = Math.round((r9/9)*255);
    let g = Math.round((g9/9)*255);
    let b = Math.round((b9/9)*255);
    
    const slot = document.getElementById(`slot${selectedSlotIndex}`);
    slot.querySelector('.slot-preview').style.backgroundColor = `rgb(${r},${g},${b})`;
    slot.innerHTML = `<div class="slot-preview" style="background:rgb(${r},${g},${b})"></div>${r9} ${g9} ${b9}`;
  }
</script>

</body>
</html>
